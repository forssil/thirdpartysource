
#include<stdlib.h>
#include<memory.h>
#include<string.h>
#include<math.h>
#include "fft1536.h"

/* reorder table */
static unsigned char reverseSplit128[128] = 
{
	0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,12,76,
	44,108,28,92,60,124,2,66,34,98,18,82,50,114,10,74,42,106,26,90,58,122,6,70,38,102,
	22,86,54,118,14,78,46,110,30,94,62,126,1,65,33,97,17,81,49,113,9,73,41,105,25,89,57,
	121,5,69,37,101,21,85,53,117,13,77,45,109,29,93,61,125,3,67,35,99,19,83,51,115,11,
	75,43,107,27,91,59,123,7,71,39,103,23,87,55,119,15,79,47,111,31,95,63,127
};

static unsigned char reverseValue256[256] = 
{
	0,64,128,192,16,80,144,208,32,96,160,224,48,112,176,240,4,68,132,196,
	20,84,148,212,36,100,164,228,52,116,180,244,8,72,136,200,24,88,152,
	216,40,104,168,232,56,120,184,248,12,76,140,204,28,92,156,220,44,108,
	172,236,60,124,188,252,1,65,129,193,17,81,145,209,33,97,161,225,49,113,
	177,241,5,69,133,197,21,85,149,213,37,101,165,229,53,117,181,245,9,73,
	137,201,25,89,153,217,41,105,169,233,57,121,185,249,13,77,141,205,29,93,
	157,221,45,109,173,237,61,125,189,253,2,66,130,194,18,82,146,210,34,98,
	162,226,50,114,178,242,6,70,134,198,22,86,150,214,38,102,166,230,54,118,
	182,246,10,74,138,202,26,90,154,218,42,106,170,234,58,122,186,250,14,78,
	142,206,30,94,158,222,46,110,174,238,62,126,190,254,3,67,131,195,19,83,
	147,211,35,99,163,227,51,115,179,243,7,71,135,199,23,87,151,215,39,103,
	167,231,55,119,183,247,11,75,139,203,27,91,155,219,43,107,171,235,59,123,
	187,251,15,79,143,207,31,95,159,223,47,111,175,239,63,127,191,255
};

static unsigned short reverse384[384] = 
{
	0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,
	105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,177,
	180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,
	255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,
	330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,1,4,7,10,13,16,19,22,25,28,
	31,34,37,40,43,46,49,52,55,58,61,64,67,70,73,76,79,82,85,88,91,94,97,100,103,106,109,112,115,118,121,
	124,127,130,133,136,139,142,145,148,151,154,157,160,163,166,169,172,175,178,181,184,187,190,193,196,
	199,202,205,208,211,214,217,220,223,226,229,232,235,238,241,244,247,250,253,256,259,262,265,268,271,274,
	277,280,283,286,289,292,295,298,301,304,307,310,313,316,319,322,325,328,331,334,337,340,343,346,349,352,
	355,358,361,364,367,370,373,376,379,382,2,5,8,11,14,17,20,23,26,29,32,35,38,41,44,47,50,53,56,59,62,65,
	68,71,74,77,80,83,86,89,92,95,98,101,104,107,110,113,116,119,122,125,128,131,134,137,140,143,146,149,152,
	155,158,161,164,167,170,173,176,179,182,185,188,191,194,197,200,203,206,209,212,215,218,221,224,227,230,
	233,236,239,242,245,248,251,254,257,260,263,266,269,272,275,278,281,284,287,290,293,296,299,302,305,308,
	311,314,317,320,323,326,329,332,335,338,341,344,347,350,353,356,359,362,365,368,371,374,377,380,383
};



/* twiddle factor table */
/* sin(2*pi*n/768) , n is from 0 to 767*/
static float twiddleFactor768[768] = 
{
	0.0000000f,  0.0081811f,  0.0163617f,  0.0245412f,  0.0327191f,  0.0408947f,  0.0490677f,  0.0572373f,  0.0654031f,  0.0735646f,  0.0817211f,  0.0898721f,  
	0.0980171f,  0.1061556f,  0.1142870f,  0.1224107f,  0.1305262f,  0.1386330f,  0.1467305f,  0.1548182f,  0.1628955f,  0.1709619f,  0.1790169f,  0.1870599f,  
	0.1950903f,  0.2031077f,  0.2111116f,  0.2191012f,  0.2270763f,  0.2350361f,  0.2429802f,  0.2509080f,  0.2588190f,  0.2667128f,  0.2745886f,  0.2824461f,  
	0.2902847f,  0.2981038f,  0.3059030f,  0.3136817f,  0.3214395f,  0.3291757f,  0.3368899f,  0.3445815f,  0.3522500f,  0.3598950f,  0.3675159f,  0.3751122f,  
	0.3826834f,  0.3902290f,  0.3977485f,  0.4052413f,  0.4127070f,  0.4201451f,  0.4275551f,  0.4349364f,  0.4422887f,  0.4496113f,  0.4569039f,  0.4641658f,  
	0.4713967f,  0.4785961f,  0.4857634f,  0.4928982f,  0.5000000f,  0.5070683f,  0.5141027f,  0.5211027f,  0.5280679f,  0.5349976f,  0.5418916f,  0.5487493f,  
	0.5555702f,  0.5623540f,  0.5691001f,  0.5758082f,  0.5824777f,  0.5891082f,  0.5956993f,  0.6022505f,  0.6087614f,  0.6152316f,  0.6216606f,  0.6280479f,  
	0.6343933f,  0.6406962f,  0.6469562f,  0.6531728f,  0.6593458f,  0.6654747f,  0.6715590f,  0.6775983f,  0.6835923f,  0.6895405f,  0.6954426f,  0.7012982f,  
	0.7071068f,  0.7128681f,  0.7185816f,  0.7242471f,  0.7298641f,  0.7354322f,  0.7409511f,  0.7464204f,  0.7518398f,  0.7572088f,  0.7625272f,  0.7677945f,  
	0.7730105f,  0.7781746f,  0.7832867f,  0.7883464f,  0.7933533f,  0.7983072f,  0.8032075f,  0.8080542f,  0.8128467f,  0.8175848f,  0.8222682f,  0.8268966f,  
	0.8314696f,  0.8359870f,  0.8404484f,  0.8448536f,  0.8492022f,  0.8534940f,  0.8577286f,  0.8619059f,  0.8660254f,  0.8700870f,  0.8740903f,  0.8780352f,  
	0.8819213f,  0.8857483f,  0.8895161f,  0.8932243f,  0.8968727f,  0.9004612f,  0.9039893f,  0.9074569f,  0.9108638f,  0.9142098f,  0.9174945f,  0.9207178f,  
	0.9238795f,  0.9269794f,  0.9300172f,  0.9329928f,  0.9359059f,  0.9387564f,  0.9415441f,  0.9442687f,  0.9469301f,  0.9495282f,  0.9520627f,  0.9545335f,  
	0.9569403f,  0.9592832f,  0.9615618f,  0.9637761f,  0.9659258f,  0.9680109f,  0.9700313f,  0.9719866f,  0.9738770f,  0.9757021f,  0.9774620f,  0.9791564f,  
	0.9807853f,  0.9823485f,  0.9838460f,  0.9852776f,  0.9866433f,  0.9879430f,  0.9891765f,  0.9903438f,  0.9914449f,  0.9924795f,  0.9934478f,  0.9943495f,  
	0.9951847f,  0.9959533f,  0.9966552f,  0.9972905f,  0.9978589f,  0.9983606f,  0.9987955f,  0.9991635f,  0.9994646f,  0.9996988f,  0.9998661f,  0.9999665f,  
	1.0000000f,  0.9999665f,  0.9998661f,  0.9996988f,  0.9994646f,  0.9991635f,  0.9987955f,  0.9983606f,  0.9978589f,  0.9972905f,  0.9966552f,  0.9959533f,  
	0.9951847f,  0.9943495f,  0.9934478f,  0.9924795f,  0.9914449f,  0.9903438f,  0.9891765f,  0.9879430f,  0.9866433f,  0.9852776f,  0.9838460f,  0.9823485f,  
	0.9807853f,  0.9791564f,  0.9774620f,  0.9757021f,  0.9738770f,  0.9719866f,  0.9700313f,  0.9680109f,  0.9659258f,  0.9637761f,  0.9615618f,  0.9592832f,  
	0.9569403f,  0.9545335f,  0.9520627f,  0.9495282f,  0.9469301f,  0.9442687f,  0.9415441f,  0.9387564f,  0.9359059f,  0.9329928f,  0.9300172f,  0.9269794f,  
	0.9238795f,  0.9207178f,  0.9174945f,  0.9142098f,  0.9108638f,  0.9074569f,  0.9039893f,  0.9004612f,  0.8968727f,  0.8932243f,  0.8895161f,  0.8857483f,  
	0.8819213f,  0.8780352f,  0.8740903f,  0.8700870f,  0.8660254f,  0.8619059f,  0.8577286f,  0.8534940f,  0.8492022f,  0.8448536f,  0.8404484f,  0.8359870f,  
	0.8314696f,  0.8268966f,  0.8222682f,  0.8175848f,  0.8128467f,  0.8080542f,  0.8032075f,  0.7983072f,  0.7933533f,  0.7883464f,  0.7832867f,  0.7781746f,  
	0.7730105f,  0.7677945f,  0.7625272f,  0.7572088f,  0.7518398f,  0.7464204f,  0.7409511f,  0.7354322f,  0.7298641f,  0.7242471f,  0.7185816f,  0.7128681f,  
	0.7071068f,  0.7012982f,  0.6954426f,  0.6895405f,  0.6835923f,  0.6775983f,  0.6715590f,  0.6654747f,  0.6593458f,  0.6531728f,  0.6469562f,  0.6406962f,  
	0.6343933f,  0.6280479f,  0.6216606f,  0.6152316f,  0.6087614f,  0.6022505f,  0.5956993f,  0.5891082f,  0.5824777f,  0.5758082f,  0.5691001f,  0.5623540f,  
	0.5555702f,  0.5487493f,  0.5418916f,  0.5349976f,  0.5280679f,  0.5211027f,  0.5141027f,  0.5070683f,  0.5000000f,  0.4928982f,  0.4857634f,  0.4785961f,  
	0.4713967f,  0.4641658f,  0.4569039f,  0.4496113f,  0.4422887f,  0.4349364f,  0.4275551f,  0.4201451f,  0.4127070f,  0.4052413f,  0.3977485f,  0.3902290f,  
	0.3826834f,  0.3751122f,  0.3675159f,  0.3598950f,  0.3522500f,  0.3445815f,  0.3368899f,  0.3291757f,  0.3214395f,  0.3136817f,  0.3059030f,  0.2981038f,  
	0.2902847f,  0.2824461f,  0.2745886f,  0.2667128f,  0.2588190f,  0.2509080f,  0.2429802f,  0.2350361f,  0.2270763f,  0.2191012f,  0.2111116f,  0.2031077f,  
	0.1950903f,  0.1870599f,  0.1790169f,  0.1709619f,  0.1628955f,  0.1548182f,  0.1467305f,  0.1386330f,  0.1305262f,  0.1224107f,  0.1142870f,  0.1061556f,  
	0.0980171f,  0.0898721f,  0.0817211f,  0.0735646f,  0.0654031f,  0.0572373f,  0.0490677f,  0.0408947f,  0.0327191f,  0.0245412f,  0.0163617f,  0.0081811f, 
	-0.0000000f, -0.0081811f, -0.0163617f, -0.0245412f, -0.0327191f, -0.0408947f, -0.0490677f, -0.0572373f, -0.0654031f, -0.0735646f, -0.0817211f, -0.0898721f,
	-0.0980171f, -0.1061556f, -0.1142870f, -0.1224107f, -0.1305262f, -0.1386330f, -0.1467305f, -0.1548182f, -0.1628955f, -0.1709619f, -0.1790169f, -0.1870599f, 
	-0.1950903f, -0.2031077f, -0.2111116f, -0.2191012f, -0.2270763f, -0.2350361f, -0.2429802f, -0.2509080f, -0.2588190f, -0.2667128f, -0.2745886f, -0.2824461f, 
	-0.2902847f, -0.2981038f, -0.3059030f, -0.3136817f, -0.3214395f, -0.3291757f, -0.3368899f, -0.3445815f, -0.3522500f, -0.3598950f, -0.3675159f, -0.3751122f,
	-0.3826834f, -0.3902290f, -0.3977485f, -0.4052413f, -0.4127070f, -0.4201451f, -0.4275551f, -0.4349364f, -0.4422887f, -0.4496113f, -0.4569039f, -0.4641658f,
	-0.4713967f, -0.4785961f, -0.4857634f, -0.4928982f, -0.5000000f, -0.5070683f, -0.5141027f, -0.5211027f, -0.5280679f, -0.5349976f, -0.5418916f, -0.5487493f, 
	-0.5555702f, -0.5623540f, -0.5691001f, -0.5758082f, -0.5824777f, -0.5891082f, -0.5956993f, -0.6022505f, -0.6087614f, -0.6152316f, -0.6216606f, -0.6280479f, 
	-0.6343933f, -0.6406962f, -0.6469562f, -0.6531728f, -0.6593458f, -0.6654747f, -0.6715590f, -0.6775983f, -0.6835923f, -0.6895405f, -0.6954426f, -0.7012982f,
	-0.7071068f, -0.7128681f, -0.7185816f, -0.7242471f, -0.7298641f, -0.7354322f, -0.7409511f, -0.7464204f, -0.7518398f, -0.7572088f, -0.7625272f, -0.7677945f, 
	-0.7730105f, -0.7781746f, -0.7832867f, -0.7883464f, -0.7933533f, -0.7983072f, -0.8032075f, -0.8080542f, -0.8128467f, -0.8175848f, -0.8222682f, -0.8268966f, 
	-0.8314696f, -0.8359870f, -0.8404484f, -0.8448536f, -0.8492022f, -0.8534940f, -0.8577286f, -0.8619059f, -0.8660254f, -0.8700870f, -0.8740903f, -0.8780352f, 
	-0.8819213f, -0.8857483f, -0.8895161f, -0.8932243f, -0.8968727f, -0.9004612f, -0.9039893f, -0.9074569f, -0.9108638f, -0.9142098f, -0.9174945f, -0.9207178f, 
	-0.9238795f, -0.9269794f, -0.9300172f, -0.9329928f, -0.9359059f, -0.9387564f, -0.9415441f, -0.9442687f, -0.9469301f, -0.9495282f, -0.9520627f, -0.9545335f,
	-0.9569403f, -0.9592832f, -0.9615618f, -0.9637761f, -0.9659258f, -0.9680109f, -0.9700313f, -0.9719866f, -0.9738770f, -0.9757021f, -0.9774620f, -0.9791564f,
	-0.9807853f, -0.9823485f, -0.9838460f, -0.9852776f, -0.9866433f, -0.9879430f, -0.9891765f, -0.9903438f, -0.9914449f, -0.9924795f, -0.9934478f, -0.9943495f, 
	-0.9951847f, -0.9959533f, -0.9966552f, -0.9972905f, -0.9978589f, -0.9983606f, -0.9987955f, -0.9991635f, -0.9994646f, -0.9996988f, -0.9998661f, -0.9999665f, 
	-1.0000000f, -0.9999665f, -0.9998661f, -0.9996988f, -0.9994646f, -0.9991635f, -0.9987955f, -0.9983606f, -0.9978589f, -0.9972905f, -0.9966552f, -0.9959533f, 
	-0.9951847f, -0.9943495f, -0.9934478f, -0.9924795f, -0.9914449f, -0.9903438f, -0.9891765f, -0.9879430f, -0.9866433f, -0.9852776f, -0.9838460f, -0.9823485f, 
	-0.9807853f, -0.9791564f, -0.9774620f, -0.9757021f, -0.9738770f, -0.9719866f, -0.9700313f, -0.9680109f, -0.9659258f, -0.9637761f, -0.9615618f, -0.9592832f, 
	-0.9569403f, -0.9545335f, -0.9520627f, -0.9495282f, -0.9469301f, -0.9442687f, -0.9415441f, -0.9387564f, -0.9359059f, -0.9329928f, -0.9300172f, -0.9269794f, 
	-0.9238795f, -0.9207178f, -0.9174945f, -0.9142098f, -0.9108638f, -0.9074569f, -0.9039893f, -0.9004612f, -0.8968727f, -0.8932243f, -0.8895161f, -0.8857483f, 
	-0.8819213f, -0.8780352f, -0.8740903f, -0.8700870f, -0.8660254f, -0.8619059f, -0.8577286f, -0.8534940f, -0.8492022f, -0.8448536f, -0.8404484f, -0.8359870f, 
	-0.8314696f, -0.8268966f, -0.8222682f, -0.8175848f, -0.8128467f, -0.8080542f, -0.8032075f, -0.7983072f, -0.7933533f, -0.7883464f, -0.7832867f, -0.7781746f, 
	-0.7730105f, -0.7677945f, -0.7625272f, -0.7572088f, -0.7518398f, -0.7464204f, -0.7409511f, -0.7354322f, -0.7298641f, -0.7242471f, -0.7185816f, -0.7128681f, 
	-0.7071068f, -0.7012982f, -0.6954426f, -0.6895405f, -0.6835923f, -0.6775983f, -0.6715590f, -0.6654747f, -0.6593458f, -0.6531728f, -0.6469562f, -0.6406962f,
	-0.6343933f, -0.6280479f, -0.6216606f, -0.6152316f, -0.6087614f, -0.6022505f, -0.5956993f, -0.5891082f, -0.5824777f, -0.5758082f, -0.5691001f, -0.5623540f, 
	-0.5555702f, -0.5487493f, -0.5418916f, -0.5349976f, -0.5280679f, -0.5211027f, -0.5141027f, -0.5070683f, -0.5000000f, -0.4928982f, -0.4857634f, -0.4785961f,
	-0.4713967f, -0.4641658f, -0.4569039f, -0.4496113f, -0.4422887f, -0.4349364f, -0.4275551f, -0.4201451f, -0.4127070f, -0.4052413f, -0.3977485f, -0.3902290f,
	-0.3826834f, -0.3751122f, -0.3675159f, -0.3598950f, -0.3522500f, -0.3445815f, -0.3368899f, -0.3291757f, -0.3214395f, -0.3136817f, -0.3059030f, -0.2981038f, 
	-0.2902847f, -0.2824461f, -0.2745886f, -0.2667128f, -0.2588190f, -0.2509080f, -0.2429802f, -0.2350361f, -0.2270763f, -0.2191012f, -0.2111116f, -0.2031077f,
	-0.1950903f, -0.1870599f, -0.1790169f, -0.1709619f, -0.1628955f, -0.1548182f, -0.1467305f, -0.1386330f, -0.1305262f, -0.1224107f, -0.1142870f, -0.1061556f, 
	-0.0980171f, -0.0898721f, -0.0817211f, -0.0735646f, -0.0654031f, -0.0572373f, -0.0490677f, -0.0408947f, -0.0327191f, -0.0245412f, -0.0163617f, -0.0081811f,
};
/* twiddle factor table */
/* sin(2*pi*n/1536) , n is from 0 to 768*/
static float twiddleFactor1536[768] = {0.f, 0.00409060402623479f, 0.00818113960393713f, 0.0122715382857199f, 0.0163617316264868f, 0.0204516511845773f, 0.0245412285229123f, 0.0286303952101390f, 0.0327190828217761f, 0.0368072229413588f, 0.0408947471615835f, 0.0449815870854523f, 0.0490676743274180f, 0.0531529405145281f,
 0.0572373172875686f, 0.0613207363022086f, 0.0654031292301431f, 0.0694844277602369f, 0.0735645635996674f, 0.0776434684750676f, 0.0817210741336682f, 0.0857973123444399f, 0.0898721148992350f, 0.0939454136139288f, 0.0980171403295606f, 0.102087226913474f, 0.106155605260457f, 0.110222207293883f,
 0.114286964966846f, 0.118349810263305f, 0.122410675199216f, 0.126469491823675f, 0.130526192220052f, 0.134580708507126f, 0.138632972840227f, 0.142682917412363f, 0.146730474455362f, 0.150775576241001f, 0.154818155082141f, 0.158858143333861f, 0.162895473394589f, 0.166930077707230f, 
 0.170961888760301f, 0.174990839089060f, 0.179016861276633f, 0.183039887955141f, 0.187059851806832f, 0.191076685565203f, 0.195090322016128f, 0.199100693998982f, 0.203107734407763f, 0.207111376192219f, 0.211111552358965f, 0.215108195972610f, 0.219101240156870f, 0.223090618095693f,
 0.227076263034373f, 0.231058108280671f, 0.235036087205927f, 0.239010133246176f, 0.242980179903264f, 0.246946160745958f, 0.250908009411060f, 0.254865659604515f, 0.258819045102521f, 0.262768099752639f, 0.266712757474898f, 0.270652952262902f, 0.274588618184932f, 0.278519689385053f,
 0.282446100084213f, 0.286367784581343f, 0.290284677254462f, 0.294196712561769f, 0.298103825042740f, 0.302005949319228f, 0.305903020096553f, 0.309794972164597f, 0.313681740398891f, 0.317563259761712f, 0.321439465303162f, 0.325310292162263f, 0.329175675568039f, 0.333035550840599f,
 0.336889853392220f, 0.340738518728429f, 0.344581482449080f, 0.348418680249435f, 0.352250047921234f, 0.356075521353776f, 0.359895036534988f, 0.363708529552499f, 0.367515936594704f, 0.371317193951838f, 0.375112238017038f, 0.378901005287410f, 0.382683432365090f, 0.386459455958303f,
 0.390229012882428f, 0.393992040061048f, 0.397748474527011f, 0.401498253423481f, 0.405241314004990f, 0.408977593638489f, 0.412707029804395f, 0.416429560097637f, 0.420145122228702f, 0.423853654024676f, 0.427555093430282f, 0.431249378508924f, 0.434936447443717f, 0.438616238538528f,
 0.442288690219001f, 0.445953741033595f, 0.449611329654607f, 0.453261394879198f, 0.456903875630421f, 0.460538710958240f, 0.464165840040552f, 0.467785202184201f, 0.471396736825998f, 0.475000383533732f, 0.478596082007181f, 0.482183772079123f, 0.485763393716340f, 0.489334887020625f,
 0.492898192229784f, 0.496453249718633f, 0.500000000000000f, 0.503538383725718f, 0.507068341687617f, 0.510589814818519f, 0.514102744193222f, 0.517607071029487f, 0.521102736689023f, 0.524589682678469f, 0.528067850650368f, 0.531537182404149f, 0.534997619887097f, 0.538449105195327f,
 0.541891580574752f, 0.545324988422046f, 0.548749271285616f, 0.552164371866554f, 0.555570233019602f, 0.558966797754107f, 0.562354009234973f, 0.565731810783613f, 0.569100145878898f, 0.572458958158102f, 0.575808191417845f, 0.579147789615035f, 0.582477696867802f, 0.585797857456439f,
 0.589108215824328f, 0.592408716578875f, 0.595699304492433f, 0.598979924503229f, 0.602250521716282f, 0.605511041404326f, 0.608761429008721f, 0.612001630140370f, 0.615231590580627f, 0.618451256282204f, 0.621660573370077f, 0.624859488142386f, 0.628047947071334f, 0.631225896804083f,
 0.634393284163646f, 0.637550056149777f, 0.640696159939861f, 0.643831542889791f, 0.646956152534857f, 0.650069936590618f, 0.653172842953777f, 0.656264819703058f, 0.659345815100069f, 0.662415777590172f, 0.665474655803342f, 0.668522398555031f, 0.671558954847018f, 0.674584273868271f,
 0.677598304995789f, 0.680600997795453f, 0.683592302022871f, 0.686572167624217f, 0.689540544737067f, 0.692497383691237f, 0.695442635009612f, 0.698376249408973f, 0.701298177800824f, 0.704208371292213f, 0.707106781186548f, 0.709993358984412f, 0.712868056384380f, 0.715730825283819f,
 0.718581617779698f, 0.721420386169390f, 0.724247082951467f, 0.727061660826497f, 0.729864072697836f, 0.732654271672413f, 0.735432211061519f, 0.738197844381584f, 0.740951125354959f, 0.743692007910687f, 0.746420446185274f, 0.749136394523459f, 0.751839807478977f, 0.754530639815318f,
 0.757208846506485f, 0.759874382737746f, 0.762527203906388f, 0.765167265622459f, 0.767794523709512f, 0.770408934205345f, 0.773010453362737f, 0.775599037650178f, 0.778174643752598f, 0.780737228572095f, 0.783286749228650f, 0.785823163060853f, 0.788346427626606f, 0.790856500703845f,
 0.793353340291235f, 0.795836904608884f, 0.798307152099032f, 0.800764041426753f, 0.803207531480645f, 0.805637581373517f, 0.808054150443073f, 0.810457198252595f, 0.812846684591615f, 0.815222569476594f, 0.817584813151584f, 0.819933376088899f, 0.822268218989775f, 0.824589302785025f,
 0.826896588635696f, 0.829190037933717f, 0.831469612302545f, 0.833735273597809f, 0.835986983907947f, 0.838224705554838f, 0.840448401094438f, 0.842658033317402f, 0.844853565249707f, 0.847034960153274f, 0.849202181526579f, 0.851355193105265f, 0.853493958862750f, 0.855618443010829f,
 0.857728610000272f, 0.859824424521420f, 0.861905851504774f, 0.863972856121587f, 0.866025403784439f, 0.868063460147822f, 0.870086991108711f, 0.872095962807139f, 0.874090341626759f, 0.876070094195407f, 0.878035187385663f, 0.879985588315404f, 0.881921264348355f, 0.883842183094633f,
 0.885748312411291f, 0.887639620402854f, 0.889516075421856f, 0.891377646069366f, 0.893224301195515f, 0.895056009900018f, 0.896872741532688f, 0.898674465693954f, 0.900461152235364f, 0.902232771260093f, 0.903989293123443f, 0.905730688433339f, 0.907456928050819f, 0.909167983090522f,
 0.910863824921176f, 0.912544425166069f, 0.914209755703531f, 0.915859788667400f, 0.917494496447491f, 0.919113851690058f, 0.920717827298248f, 0.922306396432559f, 0.923879532511287f, 0.925437209210971f, 0.926979400466833f, 0.928506080473216f, 0.930017223684012f, 0.931512804813095f,
 0.932992798834739f, 0.934457180984039f, 0.935905926757326f, 0.937339011912575f, 0.938756412469813f, 0.940158104711519f, 0.941544065183021f, 0.942914270692887f, 0.944268698313317f, 0.945607325380521f, 0.946930129495106f, 0.948237088522441f, 0.949528180593037f, 0.950803384102905f,
 0.952062677713924f, 0.953306040354194f, 0.954533451218389f, 0.955744889768106f, 0.956940335732209f, 0.958119769107168f, 0.959283170157394f, 0.960430519415566f, 0.961561797682962f, 0.962676986029777f, 0.963776065795440f, 0.964859018588927f, 0.965925826289068f, 0.966976471044852f,
 0.968010935275723f, 0.969029201671875f, 0.970031253194544f, 0.971017073076290f, 0.971986644821279f, 0.972939952205560f, 0.973876979277334f, 0.974797710357222f, 0.975702130038529f, 0.976590223187499f, 0.977461974943572f, 0.978317370719628f, 0.979156396202234f, 0.979979037351883f,
 0.980785280403230f, 0.981575111865320f, 0.982348518521816f, 0.983105487431216f, 0.983846005927077f, 0.984570061618221f, 0.985277642388941f, 0.985968736399212f, 0.986643332084879f, 0.987301418157858f, 0.987942983606322f, 0.988568017694885f, 0.989176509964781f, 0.989768450234042f,
 0.990343828597665f, 0.990902635427780f, 0.991444861373810f, 0.991970497362629f, 0.992479534598710f, 0.992971964564277f, 0.993447779019444f, 0.993906970002356f, 0.994349529829318f, 0.994775451094928f, 0.995184726672197f, 0.995577349712672f, 0.995953313646548f, 0.996312612182778f,
 0.996655239309180f, 0.996981189292537f, 0.997290456678690f, 0.997583036292635f, 0.997858923238604f, 0.998118112900149f, 0.998360600940223f, 0.998586383301244f, 0.998795456205172f, 0.998987816153568f, 0.999163459927649f, 0.999322384588350f, 0.999464587476366f, 0.999590066212201f,
 0.999698818696204f, 0.999790843108610f, 0.999866137909562f, 0.999924701839145f, 0.999966533917401f, 0.999991633444351f, 1.f, 0.999991633444351f, 0.999966533917401f, 0.999924701839145f, 0.999866137909562f, 0.999790843108610f, 0.999698818696204f, 0.999590066212201f, 0.999464587476366f, 
 0.999322384588350f, 0.999163459927649f, 0.998987816153568f, 0.998795456205172f, 0.998586383301244f, 0.998360600940223f, 0.998118112900149f, 0.997858923238604f, 0.997583036292635f, 0.997290456678690f, 0.996981189292537f, 0.996655239309180f, 0.996312612182778f, 0.995953313646548f, 
 0.995577349712672f, 0.995184726672197f, 0.994775451094928f, 0.994349529829318f, 0.993906970002356f, 0.993447779019444f, 0.992971964564277f, 0.992479534598710f, 0.991970497362629f, 0.991444861373810f, 0.990902635427780f, 0.990343828597665f, 0.989768450234042f, 0.989176509964781f,
 0.988568017694885f, 0.987942983606322f, 0.987301418157858f, 0.986643332084879f, 0.985968736399212f, 0.985277642388941f, 0.984570061618221f, 0.983846005927078f, 0.983105487431216f, 0.982348518521816f, 0.981575111865321f, 0.980785280403230f, 0.979979037351883f, 0.979156396202234f,
 0.978317370719628f, 0.977461974943572f, 0.976590223187499f, 0.975702130038529f, 0.974797710357222f, 0.973876979277334f, 0.972939952205560f, 0.971986644821280f, 0.971017073076290f, 0.970031253194544f, 0.969029201671875f, 0.968010935275723f, 0.966976471044852f, 0.965925826289068f,
 0.964859018588927f, 0.963776065795440f, 0.962676986029777f, 0.961561797682962f, 0.960430519415566f, 0.959283170157394f, 0.958119769107168f, 0.956940335732209f, 0.955744889768106f, 0.954533451218389f, 0.953306040354194f, 0.952062677713924f, 0.950803384102905f, 0.949528180593037f, 
 0.948237088522441f, 0.946930129495106f, 0.945607325380521f, 0.944268698313317f, 0.942914270692887f, 0.941544065183021f, 0.940158104711519f, 0.938756412469813f, 0.937339011912575f, 0.935905926757326f, 0.934457180984039f, 0.932992798834739f, 0.931512804813095f, 0.930017223684012f, 
 0.928506080473216f, 0.926979400466833f, 0.925437209210971f, 0.923879532511287f, 0.922306396432559f, 0.920717827298248f, 0.919113851690058f, 0.917494496447491f, 0.915859788667400f, 0.914209755703531f, 0.912544425166069f, 0.910863824921176f, 0.909167983090523f, 0.907456928050819f, 
 0.905730688433339f, 0.903989293123443f, 0.902232771260093f, 0.900461152235364f, 0.898674465693954f, 0.896872741532688f, 0.895056009900018f, 0.893224301195515f, 0.891377646069366f, 0.889516075421856f, 0.887639620402854f, 0.885748312411290f, 0.883842183094633f, 0.881921264348355f, 
 0.879985588315404f, 0.878035187385663f, 0.876070094195407f, 0.874090341626759f, 0.872095962807140f, 0.870086991108712f, 0.868063460147822f, 0.866025403784439f, 0.863972856121587f, 0.861905851504774f, 0.859824424521420f, 0.857728610000272f, 0.855618443010829f, 0.853493958862751f,
 0.851355193105265f, 0.849202181526579f, 0.847034960153274f, 0.844853565249707f, 0.842658033317402f, 0.840448401094438f, 0.838224705554838f, 0.835986983907947f, 0.833735273597809f, 0.831469612302545f, 0.829190037933717f, 0.826896588635696f, 0.824589302785025f, 0.822268218989775f, 
 0.819933376088899f, 0.817584813151584f, 0.815222569476593f, 0.812846684591615f, 0.810457198252595f, 0.808054150443073f, 0.805637581373517f, 0.803207531480645f, 0.800764041426753f, 0.798307152099032f, 0.795836904608884f, 0.793353340291235f, 0.790856500703845f, 0.788346427626606f, 
 0.785823163060853f, 0.783286749228650f, 0.780737228572095f, 0.778174643752598f, 0.775599037650178f, 0.773010453362737f, 0.770408934205345f, 0.767794523709512f, 0.765167265622459f, 0.762527203906388f, 0.759874382737746f, 0.757208846506485f, 0.754530639815318f, 0.751839807478977f, 
 0.749136394523459f, 0.746420446185274f, 0.743692007910687f, 0.740951125354959f, 0.738197844381584f, 0.735432211061519f, 0.732654271672413f, 0.729864072697836f, 0.727061660826497f, 0.724247082951467f, 0.721420386169390f, 0.718581617779698f, 0.715730825283819f, 0.712868056384380f, 0.709993358984413f, 0.707106781186548f, 0.704208371292213f, 0.701298177800825f, 0.698376249408973f, 0.695442635009612f, 0.692497383691237f, 
 0.689540544737067f, 0.686572167624217f, 0.683592302022872f, 0.680600997795453f, 0.677598304995789f, 0.674584273868271f, 0.671558954847018f, 0.668522398555031f, 0.665474655803342f, 0.662415777590172f, 0.659345815100069f, 0.656264819703058f, 0.653172842953777f, 0.650069936590618f, 
 0.646956152534857f, 0.643831542889792f, 0.640696159939861f, 0.637550056149777f, 0.634393284163646f, 0.631225896804083f, 0.628047947071334f, 0.624859488142386f, 0.621660573370078f, 0.618451256282204f, 0.615231590580627f, 0.612001630140370f, 0.608761429008721f, 0.605511041404326f,
 0.602250521716282f, 0.598979924503229f, 0.595699304492434f, 0.592408716578875f, 0.589108215824328f, 0.585797857456439f, 0.582477696867802f, 0.579147789615035f, 0.575808191417845f, 0.572458958158102f, 0.569100145878898f, 0.565731810783613f, 0.562354009234973f, 0.558966797754107f,
 0.555570233019603f, 0.552164371866554f, 0.548749271285616f, 0.545324988422046f, 0.541891580574752f, 0.538449105195328f, 0.534997619887097f, 0.531537182404149f, 0.528067850650368f, 0.524589682678469f, 0.521102736689023f, 0.517607071029487f, 0.514102744193222f, 0.510589814818519f, 
 0.507068341687617f, 0.503538383725718f, 0.500000000000000f, 0.496453249718633f, 0.492898192229784f, 0.489334887020625f, 0.485763393716340f, 0.482183772079123f, 0.478596082007181f, 0.475000383533731f, 0.471396736825998f, 0.467785202184201f, 0.464165840040552f, 0.460538710958240f, 
 0.456903875630421f, 0.453261394879198f, 0.449611329654607f, 0.445953741033596f, 0.442288690219002f, 0.438616238538528f, 0.434936447443717f, 0.431249378508924f, 0.427555093430282f, 0.423853654024676f, 0.420145122228703f, 0.416429560097638f, 0.412707029804395f, 0.408977593638489f,
 0.405241314004990f, 0.401498253423481f, 0.397748474527011f, 0.393992040061048f, 0.390229012882428f, 0.386459455958304f, 0.382683432365090f, 0.378901005287410f, 0.375112238017038f, 0.371317193951837f, 0.367515936594704f, 0.363708529552499f, 0.359895036534988f, 0.356075521353776f,
 0.352250047921233f, 0.348418680249435f, 0.344581482449081f, 0.340738518728429f, 0.336889853392220f, 0.333035550840599f, 0.329175675568039f, 0.325310292162263f, 0.321439465303162f, 0.317563259761712f, 0.313681740398891f, 0.309794972164597f, 0.305903020096554f, 0.302005949319229f,
 0.298103825042740f, 0.294196712561769f, 0.290284677254463f, 0.286367784581343f, 0.282446100084213f, 0.278519689385053f, 0.274588618184933f, 0.270652952262902f, 0.266712757474899f, 0.262768099752639f, 0.258819045102521f, 0.254865659604515f, 0.250908009411060f, 0.246946160745959f, 
 0.242980179903264f, 0.239010133246176f, 0.235036087205927f, 0.231058108280671f, 0.227076263034373f, 0.223090618095693f, 0.219101240156870f, 0.215108195972609f, 0.211111552358965f, 0.207111376192219f, 0.203107734407763f, 0.199100693998982f, 0.195090322016128f, 0.191076685565203f, 
 0.187059851806833f, 0.183039887955141f, 0.179016861276633f, 0.174990839089060f, 0.170961888760301f, 0.166930077707230f, 0.162895473394589f, 0.158858143333862f, 0.154818155082141f, 0.150775576241001f, 0.146730474455362f, 0.142682917412363f, 0.138632972840226f, 0.134580708507126f, 
 0.130526192220052f, 0.126469491823675f, 0.122410675199216f, 0.118349810263305f, 0.114286964966847f, 0.110222207293883f, 0.106155605260458f, 0.102087226913474f, 0.0980171403295608f, 0.0939454136139289f, 0.0898721148992349f, 0.0857973123444402f, 0.0817210741336679f, 0.0776434684750676f, 
 0.0735645635996677f, 0.0694844277602370f, 0.0654031292301431f, 0.0613207363022085f, 0.0572373172875689f, 0.0531529405145286f, 0.0490676743274180f, 0.0449815870854525f, 0.0408947471615836f, 0.0368072229413588f, 0.0327190828217760f, 0.0286303952101392f, 0.0245412285229128f, 0.0204516511845772f, 
 0.0163617316264870f, 0.0122715382857200f, 0.00818113960393752f, 0.00409060402623460f};



/* 128 points split-radix FFT */
int splitFFT128(float *real,float *imag)
{
	int	n,i,step=3,pos1,pos2;
	int isThisLevel[128]={0},level;
	int LStart,LFourthStart,LHalfStart,LThreeFourthStart,LEnd;
	int LSize=256,LHalfSize=128,LForthSize=64;
	float temr[128],temi[128];
	float temr1,temr2,temr3,temr4,temr5,temr6,temi1,temi2,temi3,temi4,temi5,temi6;
	float temrS,temiS,temrF,temiF,temrH,temiH,temrT,temiT;

	if(NULL==real||NULL==imag)
		return 1;

	for(n=0;n<128;n++)
	{
		temr[n] = real[n];
		temi[n] = imag[n];
	}

	isThisLevel[0] = 1;
	for(level=1;level<7;level++)
	{
		step <<= 1; 
		LSize = LSize >> 1;
		LHalfSize = LSize >> 1;
        LForthSize = LHalfSize >> 1;
		LEnd = LSize;
		for(LStart=0;LStart<128;LStart=LEnd)
		{
			LEnd = LStart + LSize;
			if(isThisLevel[LStart]==level)
			{
				pos1 = 0;
		        LFourthStart = LStart + LForthSize; 
		        LHalfStart = LStart + LHalfSize;
		        LThreeFourthStart = LHalfStart + LForthSize;

				/* update level value */
				isThisLevel[LStart] = level + 1;
				isThisLevel[LThreeFourthStart] = isThisLevel[LHalfStart] = level + 2;

				/* calculate L */
				for(n=0;n<LForthSize;n++)
				{				
					if(level!=6)
					{
						temrS = temr[LStart];
						temiS = temi[LStart];
						temrF = temr[LFourthStart];
						temiF = temi[LFourthStart];
						temrH = temr[LHalfStart];
						temiH = temi[LHalfStart];
						temrT = temr[LThreeFourthStart];
						temiT = temi[LThreeFourthStart];
						

						temr1 = temrS + temrH;
						temi1 = temiS + temiH;
						temr2 = temrF + temrT;
						temi2 = temiF + temiT;
						temr3 = temrS  - temrH;
						temi3 = temiF - temiT;
						temr4 = -temrF + temrT;
						temi4 = temiS - temiH;

						temr5 = temr3 + temi3;
   			    		temi5 = temr4 + temi4;
						temr6 = temr3 - temi3;
						temi6 = temi4 - temr4;

						/* multiply the twiddle factor */
						pos2 = pos1*3;
						temr[LHalfStart] = temr5*twiddleFactor768[pos1+192] + temi5*twiddleFactor768[pos1];
						temi[LHalfStart] = temi5*twiddleFactor768[pos1+192] - temr5*twiddleFactor768[pos1];
						temr[LThreeFourthStart] = temr6*twiddleFactor768[pos2+192] + temi6*twiddleFactor768[pos2];
						temi[LThreeFourthStart] = temi6*twiddleFactor768[pos2+192] - temr6*twiddleFactor768[pos2];
						
						pos1 += step;

					}else{

						temrS = temr[LStart];
						temiS = temi[LStart];
						temrF = temr[LFourthStart];
						temiF = temi[LFourthStart];
						temrH = temr[LHalfStart];
						temiH = temi[LHalfStart];
						temrT = temr[LThreeFourthStart];
						temiT = temi[LThreeFourthStart];

						temr1 = temrS + temrH;
						temi1 = temiS + temiH;
						temr2 = temrF + temrT;
						temi2 = temiF + temiT;

						temr3 = temrS - temrH;
						temi3 = temiF - temiT;
						temr4 = - temrF + temrT;
						temi4 = temiS - temiH;

						temr[LHalfStart] = temr3 + temi3;
   			    		temi[LHalfStart] = temr4 + temi4;
						temr[LThreeFourthStart] =  temr3 - temi3;
						temi[LThreeFourthStart] =  temi4 - temr4;
					}

					temr[LStart] = temr1;
					temi[LStart] = temi1;
					temr[LFourthStart] = temr2;
					temi[LFourthStart] = temi2;

					LStart++;
					LFourthStart++;
					LHalfStart++;
					LThreeFourthStart++;
				}
			}
		}
	}

	for(LStart=0;LStart<128;LStart+=2)
	{
		//calculate 2 points DFT
		if(isThisLevel[LStart]==7)
		{
			temr1 = temr[LStart] + temr[LStart+1];
			temi1 = temi[LStart] + temi[LStart+1];
			temr[LStart+1] = temr[LStart] - temr[LStart+1];
			temi[LStart+1] = temi[LStart] - temi[LStart+1];
			temr[LStart] = temr1;
			temi[LStart] = temi1;
		}
	}

	/* reorder */
	for(i=0;i<128;i++)
	{
		real[i] = temr[reverseSplit128[i]];
		imag[i] = temi[reverseSplit128[i]];
	}
	return 0;
}




/* 384 points FFT,len=3*128  */
int FFT384(float *real,float *imag)
{
	int column,row,i,n0,n1,n2,pos1=-2,pos2;
	float r1,r2,r3,r4,r5,s1,s2,s3,s4,s5;
	float co1,co2,co4,si1,si2,si4;
	float temr[384],temi[384];

	if((NULL==real)||(NULL==imag))
		return 1;

	co1 = -0.5000000596f;
	co2 = -0.4999999106f;
	co4 = -0.5000001788f;
	si1 = 0.8660253882f;
	si2 = -0.8660254478f;
	si4 = 0.8660252690f;
	for(column=0;column<128;column++)
	{
		n0 = column;
		n1 = column + 128;
		n2 = column + 256;
		/* 3 points DFT for every column */
		r1 = real[n0];
		s1 = imag[n0];
		r2 = real[n1];
		s2 = imag[n1];
		r3 = real[n2];
		s3 = imag[n2];

		temr[n0] = r1 + r2 + r3;
		temi[n0] = s1 + s2 + s3;
		r4 = r1 + r2*co1 + s2*si1 + r3*co2 + s3*si2;
		s4 = s1 + s2*co1 - r2*si1 + s3*co2 - r3*si2;
		r5 = r1 + r2*co2 + s2*si2 + r3*co4 + s3*si4;
		s5 = s1 + s2*co2 - r2*si2 + s3*co4 - r3*si4;

		/* multiply the twiddle factor */
		pos1 += 2;
		pos2 = pos1 << 1;
		temr[n1] = r4*twiddleFactor768[pos1+192] + s4*twiddleFactor768[pos1];
		temi[n1] = s4*twiddleFactor768[pos1+192] - r4*twiddleFactor768[pos1];
		temr[n2] = r5*twiddleFactor768[pos2+192] + s5*twiddleFactor768[pos2];
		temi[n2] = s5*twiddleFactor768[pos2+192] - r5*twiddleFactor768[pos2];
	}

	/* 128 points FFT for every row */
	for(row=0;row<3;row++)
	{
		splitFFT128(&temr[row*128],&temi[row*128]);
	}

	/* reorder */
	for(i=0;i<384;i++)
	{
		real[reverse384[i]] = temr[i];
		imag[reverse384[i]] = temi[i];	
	}
	return 0;
}




/* 1536 points FFT for real data */
int realFFT1536(float *data)
{
	int i,i2;
	float temr[769],temi[769],tem1r[769],tem1i[769],tem2r[769],tem2i[769];
    int fftlen = 768;
	if(NULL==data)
		return 1;

	/* use a 384 ponits complex series to calculate a 768 points real series */
	i2 = 0;
	for(i=0;i<fftlen;i++)
	{ 
		temr[i] = data[i2];				/* even part */
		temi[i] = data[i2+1];			/* odd part */
		i2 += 2;
	}

	FFT768(temr,temi);
	temr[fftlen] = temr[0];        /* periodicity of DFT */
	temi[fftlen] = temi[0];		/* periodicity of DFT */

	for(i=0;i<fftlen;i++)
	{
		i2 = fftlen - i;
		tem1r[i] = 0.5f*(temr[i]+temr[i2]);
		tem1i[i] = 0.5f*(temi[i]-temi[i2]);
		tem2r[i] = 0.5f*(temi[i]+temi[i2]);
		tem2i[i] = -0.5f*(temr[i]-temr[i2]);
	}

	i2 = 0;
	for(i=0;i<fftlen;i++)
	{
		i2 = (i+384);
		if(i2<768){
			data[2*i] = (tem1r[i] + tem2r[i]*twiddleFactor1536[i2] + tem2i[i]*twiddleFactor1536[i])/1536;
			data[2*i+1] = (tem1i[i] + tem2i[i]*twiddleFactor1536[i2] - tem2r[i]*twiddleFactor1536[i]) / 1536;
		}else
		{
			i2 %= 768;
			data[2*i] = (tem1r[i] - tem2r[i]*twiddleFactor1536[i2] + tem2i[i]*twiddleFactor1536[i]) / 1536;
			data[2*i+1] = (tem1i[i] - tem2i[i]*twiddleFactor1536[i2] - tem2r[i]*twiddleFactor1536[i]) / 1536;
		}
	}
	return 0;
}


int realFFT768(float *data)
{
	int i,i2;
	float temr[385],temi[385],tem1r[384],tem1i[384],tem2r[384],tem2i[384];

	if(NULL==data)
		return 1;

	/* use a 384 ponits complex series to calculate a 768 points real series */
	i2 = 0;
	for(i=0;i<384;i++)
	{ 
		temr[i] = data[i2];				/* even part */
		temi[i] = data[i2+1];			/* odd part */
		i2 += 2;
	}

	FFT384(temr,temi);
	temr[384] = temr[0];        /* periodicity of DFT */
	temi[384] = temi[0];		/* periodicity of DFT */

	for(i=0;i<384;i++)
	{
		i2 = 384 - i;
		tem1r[i] = 0.5f*(temr[i]+temr[i2]);
		tem1i[i] = 0.5f*(temi[i]-temi[i2]);
		tem2r[i] = 0.5f*(temi[i]+temi[i2]);
		tem2i[i] = -0.5f*(temr[i]-temr[i2]);
	}

	i2 = 0;
	for(i=0;i<384;i++)
	{
		data[2*i] = (tem1r[i] + tem2r[i]*twiddleFactor768[i+192] + tem2i[i]*twiddleFactor768[i])/768;
		data[2*i+1] = (tem1i[i] + tem2i[i]*twiddleFactor768[i+192] - tem2r[i]*twiddleFactor768[i])/768;
	}
	return 0;
}



/* 256 points FFT in radix 4 */
int FFT256(float *real,float *imag)
{
	int i,j,i1,i2,i3,n1,n2,levelNum,step=3,pos1=-3,pos2,pos3;
	double r0,r1,r2,r3,s0,s1,s2,s3;
	double co1,co2,co3,si1,si2,si3;

	if((NULL==real)||(NULL==imag))
		return 1;

	n2 = 256;
	for(levelNum=1;levelNum<=4;levelNum++)
	{
		n1 = n2;						/* n1 = len/4^(levelNum-1) */
		n2 >>= 2;						/* n2 = len/4^levelNum */

		for(i=0;i<n2;i++)
		{
			/* get twiddle factor */
			pos1 += step;
			pos2 = pos1 + pos1;
			pos3 = pos1 + pos2;

			co1 = twiddleFactor768[pos1+192];
			co2 = twiddleFactor768[pos2+192];
			co3 = twiddleFactor768[pos3+192];
			si1 = twiddleFactor768[pos1];
			si2 = twiddleFactor768[pos2];
			si3 = twiddleFactor768[pos3];

			for(j=i;j<256;j+=n1)
			{
				i1 = j + n2;
				i2 = i1 + n2;
				i3 = i2 + n2;
				
				/* 4 points DFT */
				r0 = real[j] + real[i1] + real[i2] + real[i3];
				s0 = imag[j] + imag[i1] + imag[i2] + imag[i3];
				r1 = real[j] + imag[i1] - real[i2] - imag[i3];
				s1 = imag[j] - real[i1] - imag[i2] + real[i3];
				r2 = real[j] - real[i1] + real[i2] - real[i3];
				s2 = imag[j] - imag[i1] + imag[i2] - imag[i3];
				r3 = real[j] - imag[i1] - real[i2] + imag[i3];
				s3 = imag[j] + real[i1] - imag[i2] - real[i3];

				real[j] = (float)r0;
				imag[j] = (float)s0;
				real[i1] = (float)(co1*r1 + si1*s1);
				imag[i1] = (float)(co1*s1 - si1*r1);
				real[i2] = (float)(co2*r2 + si2*s2);
				imag[i2] = (float)(co2*s2 - si2*r2);
				real[i3] = (float)(co3*r3 + si3*s3);
				imag[i3] = (float)(co3*s3 - si3*r3);
			}
		}
		step <<= 2;
		pos1 = -step;
	}

	/* reorder */
	for(i=0;i<256;i++)
	{
		if( i < (reverseValue256[i]) )
		{
			r0 = real[i];
			real[i] = real[(reverseValue256[i])];
			real[(reverseValue256[i])] = (float)r0;

			s0 = imag[i];
			imag[i] = imag[(reverseValue256[i])];
			imag[(reverseValue256[i])] = (float)s0;
		}	
	}

	return 0;
}


//out_put is real. imag will be modified.
int InvFFT256(float *real,float *imag)
{
	int i;
	float tmp;
	float *imfp=imag;
	if (real==NULL || imag==NULL)
	{
		return 1;
	}
	for (i=0;i<256;i++)
	{
		*imfp*=-1.f;
		imfp++;
	}
	FFT256(real,imag);
	imfp=real;
	tmp=1.f/256.f;
	for (i=0;i<256;i++)
	{
		*imfp*=tmp;
		imfp++;
	}
	return 0;
}




/* 768 points FFT,can be used for complex data */
int FFT768(float *real,float *imag)
{
	int column,row,i,j;
	float e1,e2,e4,r0,r1,r2,s0,s1,s2;
	float co1,co2,co4,si1,si2,si4;

	if((NULL==real)||(NULL==imag))
		return 1;
	e1 = (6.28318530718f/3.f);	/* 2*pi/3   */
	e2 = e1 + e1;			    /* 2*2*pi/3 */
	e4 = e2 + e2;			    /* 4*2*pi/3 */
	co1 = (float)cos(e1);
	co2 = (float)cos(e2);
	co4 = (float)cos(e4);
	si1 = (float)sin(e1);
	si2 = (float)sin(e2);
	si4 = (float)sin(e4);
	for(column=0;column<256;column++)
	{
		/* 3 points DFT for every column */
		r0 = real[column];
		s0 = imag[column];
		r1 = real[column+256];
		s1 = imag[column+256];
		r2 = real[column+512];
		s2 = imag[column+512];
		real[column] = r0 + r1 + r2;
		imag[column] = s0 + s1 + s2;
		{
			real[column+256] = r0 + r1*co1 + s1*si1 + r2*co2 + s2*si2;
			imag[column+256] = s0 + s1*co1 - r1*si1 + s2*co2 - r2*si2;
			real[column+512] = r0 + r1*co2 + s1*si2 + r2*co4 + s2*si4;
			imag[column+512] = s0 + s1*co2 - r1*si2 + s2*co4 - r2*si4;
		}
		
		r1 = real[column+256];
		s1 = imag[column+256];
		r2 = real[column+512];
		s2 = imag[column+512];
		/* multiply the twiddle factor */
		real[column+256] = r1*twiddleFactor768[column+192] + s1*twiddleFactor768[column];
		imag[column+256] = s1*twiddleFactor768[column+192] - r1*twiddleFactor768[column];
		real[column+512] = r2*twiddleFactor768[column*2+192] + s2*twiddleFactor768[column*2];
		imag[column+512] = s2*twiddleFactor768[column*2+192] - r2*twiddleFactor768[column*2];
	}

	/* 256 points FFT for every row */
	for(row=0;row<3;row++)
	{
		FFT256(&real[row*256],&imag[row*256]);
	}

	/* reorder */
	{
		float temr[768];
		float temi[768];
		i=0;
		for(row=0;row<3;row++)
		{
			for(column=0;column<256;column++)
			{
				j = 3*column+row;
				temr[j] = real[i];
				temi[j] = imag[i];
				i++;
			}
		}
		for(i=0;i<768;i++)
		{
			
		    real[i] = temr[i];
			imag[i] = temi[i];
			
		}
	}

	return 0;
}


/* 1536 points FFT,can be used for complex data */
int FFT1536(float *real,float *imag)
{
	int column,row,i,j;
	float e1,e2,e4,r0,r1,r2,s0,s1,s2;
	float co1,co2,co4,si1,si2,si4;
 
	float temr[1536];
	float temi[1536];
	if((NULL==real)||(NULL==imag))
		return 1;

	for(column=0;column<768;column++)
	{
		/* 3 points DFT for every column */
		r0 = real[column];
		s0 = imag[column];
		r1 = real[column+768];
		s1 = imag[column+768];

		temr[column] = r0 + r1;
		temi[column] = s0 + s1;
		{
			temr[column+768] = r0 - r1;
			temi[column+768] = s0 - s1 ;

		}	
		r1 = temr[column+768];
		s1 = temi[column+768];

		/* multiply the twiddle factor */
        i = (column+384);
		if(i<768){
			temr[column+768] = r1*twiddleFactor1536[i] + s1*twiddleFactor1536[column];
			temi[column+768] = s1*twiddleFactor1536[i] - r1*twiddleFactor1536[column];
		}
		else{
			i %= 768;
			temr[column+768] = -r1*twiddleFactor1536[i] + s1*twiddleFactor1536[column];
			temi[column+768] = -s1*twiddleFactor1536[i] - r1*twiddleFactor1536[column];
		}

		
	}

	/* 256 points FFT for every row */
	for(row=0;row<2;row++)
	{
		FFT768(&temr[row*768],&temi[row*768]);
	}

	/* reorder */
	{

		i=0;
		for(row=0;row<2;row++)
		{
			for(column=0;column<768;column++)
			{
				j = 2*column+row;
				real[j] = temr[i];
				imag[j] = temi[i];
				i++;
			}
		}

	}

	return 0;
}


//out_put is real. imag will be modified.
int InvFFT768(float *real,float *imag)
{
	int i;
	float tmp;
	float *imfp=imag;
	if (real==NULL || imag==NULL)
	{
		return 1;
	}
	for (i=0;i<768;i++)
	{
		*imfp*=-1.f;
		imfp++;
	}
	FFT768(real,imag);
	imfp=real;
	tmp=1.f/768.f;
	for (i=0;i<768;i++)
	{
		*imfp*=tmp;
		imfp++;
	}
	return 0;
}

//out_put is real. imag will be modified.
int InvFFT1536(float *real,float *imag)
{
	int i;
	float tmp;
	float *imfp=imag;
	if (real==NULL || imag==NULL)
	{
		return 1;
	}
	for (i=0;i<1536;i++)
	{
		*imfp*=-1.f;
		imfp++;
	}
	FFT1536(real,imag);
	imfp=real;
	tmp=1.f/1536.f;
	for (i=0;i<1536;i++)
	{
		*imfp*=tmp;
		imfp++;
	}
	return 0;
}



/* fft for len = 2^n */
/* do fft in radix-4 if len = 4^n */
/* do fft in split radix if len is not 4^n */
int FFT2pw(float *real,float *imag,int len)
{
	int i,level;

	if((NULL==real)||(NULL==imag))
		return 1;

	level = 1;
	for(i=1;level<32;level++)
	{
		i <<= 1;
		if(i==len) break;       /* len=2^level */
		if(i>len) return 1;
	}

	if(level%2==0)
	{
		if(wbxRadixFourFFT(real,imag,len)!=0)
			return 1;
	}
	else
	{
		if(wbxsplitRadixFFT(real,imag,len)!=0)
			return 1;
	}

	return 0;
}


//out_put is real. imag will be modified.
int InvFFT2pw(float *real,float *imag,int len)
{
	int i;
	float tmp;
	float *imfp=imag;
	if ((real==NULL) || (imag==NULL)|| (len<=0))
	{
		return 1;
	}
	for (i=0;i<len;i++)
	{
		*imfp*=-1.f;
		imfp++;
	}
	FFT2pw(real,imag,len);
	imfp=real;
	tmp=1.f/(float)len;
	for (i=0;i<len;i++)
	{
		*imfp*=tmp;
		imfp++;
	}
	return 0;
}


/* fft in radix 4 for len = 4^n */
int wbxRadixFourFFT(float *real,float *imag,int len)
{
	int i,j,level,i1,i2,i3,n1,n2,levelNum;
	double nk1,nk2,nk3,e,r0,r1,r2,r3,s0,s1,s2,s3;
	double co1,co2,co3,si1,si2,si3;

	if((NULL==real)||(NULL==imag))
		return 1;

	level = 1;
	for(i=1;level<16;level++)
	{
		i <<= 2;
		if(i==len) break;       /* len=4^level */
		if(i>len) return 1;
	}

	n2 = len;
	for(levelNum=1;levelNum<=level;levelNum++)
	{
		n1 = n2;						/* n1 = len/4^(levelNum-1) */
		n2 >>= 2;						/* n2 = len/4^levelNum */
		e = 6.28318530718/n1;			/* e = 2*pi/4^levelNum */

		for(i=0;i<n2;i++)
		{
			/* calculate twiddle factor */
			nk1 = e*i;
			nk2 = nk1 + nk1;
			nk3 = nk1 + nk2;

			co1 = cos(nk1);
			co2 = cos(nk2);
			co3 = cos(nk3);
			si1 = sin(nk1);
			si2 = sin(nk2);
			si3 = sin(nk3);

			for(j=i;j<len;j+=n1)
			{
				i1 = j + n2;
				i2 = i1 + n2;
				i3 = i2 + n2;
				
				/* 4 points DFT */
				r0 = real[j] + real[i1] + real[i2] + real[i3];
				s0 = imag[j] + imag[i1] + imag[i2] + imag[i3];
				r1 = real[j] + imag[i1] - real[i2] - imag[i3];
				s1 = imag[j] - real[i1] - imag[i2] + real[i3];
				r2 = real[j] - real[i1] + real[i2] - real[i3];
				s2 = imag[j] - imag[i1] + imag[i2] - imag[i3];
				r3 = real[j] - imag[i1] - real[i2] + imag[i3];
				s3 = imag[j] + real[i1] - imag[i2] - real[i3];

				real[j] = (float)r0;
				imag[j] = (float)s0;
				real[i1] = (float)(co1*r1 + si1*s1);
				imag[i1] = (float)(co1*s1 - si1*r1);
				real[i2] = (float)(co2*r2 + si2*s2);
				imag[i2] = (float)(co2*s2 - si2*r2);
				real[i3] = (float)(co3*r3 + si3*s3);
				imag[i3] = (float)(co3*s3 - si3*r3);
			}
		}
	}

	/* reorder */
	for(i=0,j=0;i<len-1;i++)
	{
		if(i<=j)
		{
			r0 = real[i];
			real[i] = real[j];
			real[j] = (float)r0;
			r0 = imag[i];
			imag[i] = imag[j];
			imag[j] = (float)r0;
		}
		n1 = len/4;
		while(3*n1<(j+1))
		{
			j = j - 3 * n1;
			n1 = n1/4;
		}
		j = j + n1;
	}
	return 0;
}




/* fft in split-radix for len = 2^n */
int wbxsplitRadixFFT(float *real,float *imag,int len)
{
	int	n,i,j,step=1,pos1,pos2;
	int *isThisLevel,level,levelNum;
	int LStart,LFourthStart,LHalfStart,LThreeFourthStart,LEnd;
	int LSize=len<<1,LHalfSize=len,LForthSize=len>>1;
	float *temr,*temi;
	float temr1,temr2,temr3,temr4,temr5,temr6,temi1,temi2,temi3,temi4,temi5,temi6;
	float temrS,temiS,temrF,temiF,temrH,temiH,temrT,temiT;
	float *twiddleFactor,e,nk;

	if(NULL==real||NULL==imag)
		return 1;

	levelNum = 1;
	for(i=1;levelNum<32;levelNum++)
	{
		i <<= 1;
		if(i==len) break;       /* len=2^levelNum */
		if(i>len) 
			return 1;
	}

	twiddleFactor = (float*)malloc(3*len*sizeof(float));	
	if(NULL==twiddleFactor)
         return 1;
	memset(twiddleFactor,0,3*len*sizeof(float));
	temr = twiddleFactor+len;
	temi = temr+len;
	
	
	

	isThisLevel = (int*)malloc(len*sizeof(int));	
	if(NULL==isThisLevel)
	{
		free(twiddleFactor);
		twiddleFactor = NULL;
        return 1;
	}
	memset(isThisLevel,0,len*sizeof(int));

	/* calculate twiddle factors */
	e = (float)6.28318530718/len;
	for(n=0;n<len;n++)
	{
		nk = e * n;
		twiddleFactor[n] = (float)sin(nk); 
	}

	

	for(n=0;n<len;n++)
	{
		temr[n] = real[n];
		temi[n] = imag[n];
	}

	isThisLevel[0] = 1;
	for(level=1;level<levelNum;level++)
	{ 
		LSize >>= 1;
		LHalfSize = LSize >> 1;
        LForthSize = LHalfSize >> 1;
		LEnd = LSize;
		for(LStart=0;LStart<len;LStart=LEnd)
		{
			LEnd = LStart + LSize;
			if(isThisLevel[LStart]==level)
			{
				pos1 = 0;
		        LFourthStart = LStart + LForthSize; 
		        LHalfStart = LStart + LHalfSize;
		        LThreeFourthStart = LHalfStart + LForthSize;

				/* update level value */
				isThisLevel[LStart] = level + 1;
				isThisLevel[LThreeFourthStart] = isThisLevel[LHalfStart] = level + 2;

				/* calculate L */
				for(n=0;n<LForthSize;n++)
				{				
					if(level!=levelNum)
					{
						temrS = temr[LStart];
						temiS = temi[LStart];
						temrF = temr[LFourthStart];
						temiF = temi[LFourthStart];
						temrH = temr[LHalfStart];
						temiH = temi[LHalfStart];
						temrT = temr[LThreeFourthStart];
						temiT = temi[LThreeFourthStart];
						

						temr1 = temrS + temrH;
						temi1 = temiS + temiH;
						temr2 = temrF + temrT;
						temi2 = temiF + temiT;
						temr3 = temrS  - temrH;
						temi3 = temiF - temiT;
						temr4 = -temrF + temrT;
						temi4 = temiS - temiH;

						temr5 = temr3 + temi3;
   			    		temi5 = temr4 + temi4;
						temr6 = temr3 - temi3;
						temi6 = temi4 - temr4;

						/* multiply the twiddle factor */
						pos2 = pos1*3;
						temr[LHalfStart] = temr5*twiddleFactor[pos1+len/4] + temi5*twiddleFactor[pos1];
						temi[LHalfStart] = temi5*twiddleFactor[pos1+len/4] - temr5*twiddleFactor[pos1];
						temr[LThreeFourthStart] = temr6*twiddleFactor[pos2+len/4] + temi6*twiddleFactor[pos2];
						temi[LThreeFourthStart] = temi6*twiddleFactor[pos2+len/4] - temr6*twiddleFactor[pos2];
						
						pos1 += step;

					}else{

						temrS = temr[LStart];
						temiS = temi[LStart];
						temrF = temr[LFourthStart];
						temiF = temi[LFourthStart];
						temrH = temr[LHalfStart];
						temiH = temi[LHalfStart];
						temrT = temr[LThreeFourthStart];
						temiT = temi[LThreeFourthStart];

						temr1 = temrS + temrH;
						temi1 = temiS + temiH;
						temr2 = temrF + temrT;
						temi2 = temiF + temiT;

						temr3 = temrS - temrH;
						temi3 = temiF - temiT;
						temr4 = - temrF + temrT;
						temi4 = temiS - temiH;

						temr[LHalfStart] = temr3 + temi3;
   			    		temi[LHalfStart] = temr4 + temi4;
						temr[LThreeFourthStart] =  temr3 - temi3;
						temi[LThreeFourthStart] =  temi4 - temr4;
					}

					temr[LStart] = temr1;
					temi[LStart] = temi1;
					temr[LFourthStart] = temr2;
					temi[LFourthStart] = temi2;

					LStart++;
					LFourthStart++;
					LHalfStart++;
					LThreeFourthStart++;
				}
			}
		}
		step <<= 1;
	}

	for(LStart=0;LStart<len;LStart+=2)
	{
		//calculate 2 points DFT
		if(isThisLevel[LStart]==levelNum)
		{
			temr1 = temr[LStart] + temr[LStart+1];
			temi1 = temi[LStart] + temi[LStart+1];
			temr[LStart+1] = temr[LStart] - temr[LStart+1];
			temi[LStart+1] = temi[LStart] - temi[LStart+1];
			temr[LStart] = temr1;
			temi[LStart] = temi1;
		}
	}

	/* reorder */
	for(i=0,j=0;i<len-1;i++)
	{
		if(i<=j)
		{
			real[i] = temr[j];
			imag[i] = temi[j];
			real[j] = temr[i];
			imag[j] = temi[i];
		}
		n = len >> 1;
		while(n<j+1)
		{
			j = j - n;
			n = n >> 1;
		}
		j = j + n;
	}
	real[len-1] = temr[len-1];
	imag[len-1] = temi[len-1];

	free(twiddleFactor);
	twiddleFactor = NULL;
    // for coverity 10059 Free of address-of expression: since temr and temi are part of twiddleFactor, free twiddleFactor is enough
//    free(temr);
	temr = NULL;
//    free(temi);
	temi = NULL;
	free(isThisLevel);
	isThisLevel = NULL;

	return 0;
}

/*Unified interface*/
/*this is FFT for real-signal input.
  attention:
  it support 768, 256, and 2^N points samples;
  other points will cause erro output
  input is r
*/
int wbxFFT(float *real,float *imag,int len)
{
	int i,j,k;
	if (len==768)
	{
		return realFFT768(real);
	}
	else if(len == 1536)
	{
		return realFFT1536(real);

	}
	else if (len==256)
	{
		memset(imag ,0,1024);
		i=FFT256(real,imag);
		
		for (j=0;j<128;j+=2)
		{
			imag[j+128]=real[j] /len;
			imag[j+129]=real[j+1] /len;	

		}
		for (j=0;j<128;j++)
		{
			i=2*j;
			real[i]=imag[j+128];
			real[i+1]=imag[j]/len;
		}
		return i;
		
	}
	else
	{
		memset(imag ,0,sizeof(float)*len);
		FFT2pw(real,imag,len);
		k=len/2;
		for (j = 0; j < k; j += 2)
		{
			imag[j + k] = real[j] / len;
			imag[j + k + 1] = real[j + 1] / len;

		}
		for (j = 0; j < k; j++)
		{
			i = 2 * j;
			real[i] = imag[j + k];
			real[i + 1] = imag[j] / len;
		}
		return i;
	}
}

int wbxInvFFT(float *real,float *imag,int len)
{
	int i, j, k;
	k = len / 2;
	for (j = 0; j < k; j++)
	{
		i = 2 * j;
		imag[j] = real[i + 1] * len;
		real[j] = real[i] * len;
	}
	imag[k] = 0.f;
	real[k] = 0.f;

	for (j = 1; j < k; j++)
	{
		real[len - j] = real[j];
		imag[len - j] = -imag[j];
	}
	//int i,j,k;
	if (len==768)
	{
		return InvFFT768(real,imag);
	}
	else if(len == 1536)
	{
		return InvFFT1536(real,imag);
	}
	else if (len==256)
	{
		return InvFFT256(real,imag);	

	}
	else
	{
		return InvFFT2pw(real,imag,len);
		
	}

}


